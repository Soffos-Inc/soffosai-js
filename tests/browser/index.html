<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
</head>

<body>
  <div class="container py-5">
    <h3>Text and File Upload Form</h3>
    <div class="form-group">
      <input type="text" class="form-control" id="myText" placeholder="Enter your text">
    </div>
    <div class="form-group">
      <div class="custom-file">
        <input type="file" class="custom-file-input" id="myFile">
        <label class="custom-file-label" for="myFile">Choose file</label>
      </div>
    </div>
    <button type="button" class="btn btn-primary" id="sendTextBtn">Find Ambiguity</button>
    <button type="button" class="btn btn-secondary" id="sendFileBtn">Convert the File</button>
    
    <div class="form-group mt-4">
      <label for="executionCode">Execution Code: </label>
      <input type="text" class="form-control" id="executionCode">
    </div>
    <button type="button" class="btn btn-success" id="fileIngestBtn">Convert and Ingest File</button>
    <button type="button" class="btn btn-danger" id="terminatePipe">Terminate Pipeline</button>
    
    <h3 class="mt-5">Response</h3>
    <pre id="response"></pre>
  </div>
  
  <script>
    $('.custom-file-input').on('change', function() { 
       let fileName = $(this).val().split('\\').pop(); 
       $(this).next('.custom-file-label').addClass("selected").html(fileName); 
    });
  </script>
  
  <script src="https://unpkg.com/soffosai@0.1.3/dist/soffosai.bundle.js"></script>

  <script>

    document.querySelector('#sendTextBtn').addEventListener('click', sendText);
    document.querySelector("#fileIngestBtn").addEventListener('click', fileIngest);
    const my_apiKey = "Token 3bfc2547-145c-4e55-902a-b33ea70db37a";
    const response1 = document.getElementById("response");

    async function sendText() {
        const text_input = document.getElementById("myText").value;
        let service = new soffosai.SoffosServices.AmbiguityDetectionService({apiKey: my_apiKey});
        let response = await service.call('client', text_input);
        response1.textContent = JSON.stringify(response, null, 2);
    }
    
    async function fileIngest() {
        response1.textContent = "";
        const file1 = document.getElementById("myFile").files[0];
        const execution_code = document.getElementById("executionCode").value;
        let pipe = new soffosai.SoffosPipelines.FileIngestPipeline({apiKey: my_apiKey});
        let response = await pipe.call("client_id", file1, 0, execution_code);
        response1.textContent = JSON.stringify(response, null, 2);
    }
  </script>

</body>

</html>